Step 3: Add Routes to server/routes.ts
3.1 Add Imports at Top of File
Add these imports to server/routes.ts:
typescript// Manufacturing Assessment Imports
import { 
  generateManufacturingRiskScenariosWithAI,
  assessSingleManufacturingThreat,
  generateManufacturingNarrative,
  ManufacturingAssessmentContext,
  ManufacturingAIAssessmentResponse,
} from './services/manufacturing-ai-risk-assessment';

import {
  calculateVulnerabilityFromInterview,
  calculateThreatLikelihoodFromInterview,
  calculateImpactFromInterview,
  calculateOverallSecurityScore,
  generateControlRecommendations,
  getPrioritizedControlRecommendations,
  calculateRiskForThreat,
  initializeRiskScenariosFromInterview,
  MANUFACTURING_THREATS,
  THREAT_CONTROL_MAPPING,
  QUESTION_THREAT_MAPPING,
} from './services/manufacturing-interview-mapper';

import {
  MANUFACTURING_INTERVIEW_QUESTIONS,
  SECTION_METADATA,
  MANUFACTURING_SECTIONS,
  MANUFACTURING_ZONES,
  getQuestionsBySection,
  getQuestionById,
  getAllQuestionsFlattened,
  getQuestionnaireStats,
} from './services/manufacturing-interview-questionnaire';
3.2 Add Route Definitions
Copy the complete route block from manufacturing-route-integration-guide.ts (the MANUFACTURING_ROUTES_BLOCK export) into your server/routes.ts file.
The routes to add are:
typescript// POST /api/assessments/:id/manufacturing-interview/generate-risks-ai
// POST /api/assessments/:id/manufacturing-interview/assess-single-threat
// POST /api/assessments/:id/manufacturing-interview/generate-narrative
// GET  /api/assessments/:id/manufacturing-interview/threats
// POST /api/assessments/:id/manufacturing-interview/calculate-ip-theft-risk
// GET  /api/controls/manufacturing
// POST /api/assessments/:id/manufacturing-interview/get-control-recommendations
// POST /api/assessments/:id/manufacturing-interview/get-threat-breakdown
// POST /api/assessments/:id/manufacturing-interview/prioritize-threats
// GET  /api/assessments/:id/manufacturing-interview/questions
// GET  /api/assessments/:id/manufacturing-interview/industry-benchmarks
// GET  /api/assessments/:id/manufacturing-interview/zones
// POST /api/assessments/:id/manufacturing-interview/save-responses

Step 4: Add Manufacturing Template to Template Registry
If you have a template registry or configuration file, add the manufacturing template:
typescript// In your template registry/config
{
  id: 'manufacturing',
  name: 'Manufacturing Facility',
  description: 'Security assessment for manufacturing facilities including production areas, IP protection, and CFATS compliance',
  facilityType: 'manufacturing',
  questionCount: 74,
  sectionCount: 10,
  threatCount: 15,
  controlCount: 80,
  features: [
    'IP theft prevention',
    'Industrial espionage detection',
    'CFATS compliance',
    'Insider threat program',
    'Production area security'
  ],
  icon: 'Factory', // or appropriate icon
  enabled: true,
}

Step 5: Update Database Schema (If Needed)
Ensure your risk_scenarios table has these columns for AI evidence storage:
sql-- Check if columns exist, add if missing
ALTER TABLE risk_scenarios 
ADD COLUMN IF NOT EXISTS ai_evidence JSONB,
ADD COLUMN IF NOT EXISTS ai_confidence VARCHAR(20);

Step 6: Verify Environment Variables
Ensure OpenAI API key is configured for AI assessments:
bash# Required for AI-powered assessments
OPENAI_API_KEY=your-openai-api-key
The system will automatically fall back to algorithmic calculations if the API key is missing or API calls fail.

Step 7: Test the Integration
7.1 Test Questions Endpoint
bashcurl http://localhost:5000/api/assessments/1/manufacturing-interview/questions
Expected: Returns 74 questions across 10 sections
7.2 Test Threats Endpoint
bashcurl http://localhost:5000/api/assessments/1/manufacturing-interview/threats
Expected: Returns 15 manufacturing threats
7.3 Test Controls Endpoint
bashcurl http://localhost:5000/api/controls/manufacturing
Expected: Returns 80 controls across 10 categories
7.4 Test Risk Calculation
bashcurl -X POST http://localhost:5000/api/assessments/1/manufacturing-interview/calculate-ip-theft-risk \
  -H "Content-Type: application/json" \
  -d '{
    "interviewResponses": {
      "facility_1": "discrete_manufacturing",
      "facility_3": "$100 million - $500 million",
      "facility_6": "yes",
      "production_1": "yes",
      "ip_2": "yes",
      "ip_5": "yes",
      "personnel_1": "Yes, comprehensive checks for all employees",
      "personnel_3": "yes"
    }
  }'
Expected: Returns security score, IP protection level, insider threat risk
7.5 Test Full Scenario Generation (Algorithmic)
bashcurl -X POST http://localhost:5000/api/assessments/1/manufacturing-interview/generate-risks-ai \
  -H "Content-Type: application/json" \
  -d '{
    "interviewResponses": {
      "facility_1": "discrete_manufacturing",
      "facility_3": "$100 million - $500 million",
      "facility_6": "yes",
      "production_1": "yes"
    },
    "useAI": false
  }'
Expected: Returns 15 generated scenarios with risk levels

Step 8: Frontend Integration (Optional)
If integrating with the frontend interview wizard:
8.1 Add Manufacturing Option to Assessment Creation
typescript// In assessment creation component
const facilityTypes = [
  // ... existing types
  { value: 'manufacturing', label: 'Manufacturing Facility' },
];
8.2 Use the React Hook (from route-integration-guide.ts)
typescriptimport { useManufacturingAssessment } from '@/hooks/useManufacturingAssessment';

function ManufacturingAssessmentPage({ assessmentId }) {
  const {
    calculateRisk,
    prioritizeThreats,
    generateScenarios,
    saveResponses,
    riskResult,
    isLoading,
  } = useManufacturingAssessment(assessmentId);
  
  // Use in your interview wizard
}